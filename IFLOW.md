# 智能学习管理系统项目说明 (IFLOW.md)

## 项目概述

这是一个基于Flask和AI技术的智能学习管理系统，旨在提供个性化的学习体验。系统支持多学科管理，具备AI驱动的知识点讲解、智能试卷生成、在线答题和自动批改等功能。

### 核心功能

1. **学科管理**
   - 动态添加/删除学科
   - AI自动生成学科知识库和考试模板
   - 学科章节和知识点配置

2. **智能学习**
   - AI生成知识点详细讲解
   - 知识点缓存机制提升性能
   - 交互式学习界面

3. **智能考试**
   - AI自动生成多种题型试卷（选择题、判断题等）
   - 在线答题界面，支持实时保存
   - 考试计时和进度跟踪
   - 自动评分和详细结果分析

4. **考试记录管理**
   - 历次考试记录查询
   - 详细考试结果展示
   - 成绩统计和分析

5. **AI服务集成**
   - 支持多种AI模型（Ollama、阿里云、腾讯云）
   - 可配置的AI模型参数
   - 统一的AI服务接口

## 技术架构

### 后端技术栈
- **框架**: Flask
- **AI服务**: OpenAI API兼容接口（支持Ollama、阿里云、腾讯云等）
- **数据存储**: JSON文件存储（知识库、考试记录等）
- **缓存**: 内存缓存 + 文件缓存
- **配置管理**: JSON配置文件

### 前端技术栈
- **模板引擎**: Jinja2
- **UI框架**: Bootstrap 5
- **交互**: JavaScript (原生+Fetch API)
- **图标**: Font Awesome

### 目录结构
```
weblearn/
├── app.py                 # 主应用文件
├── ai_service.py          # AI服务接口
├── requirements.txt       # Python依赖
├── config/                # 配置文件
│   ├── settings_manager.py # 设置管理
│   └── settings.json      # 系统设置
├── data/                  # 数据文件
│   └── subjects/          # 各学科数据
├── templates/             # HTML模板
├── static/                # 静态资源
│   ├── css/
│   └── js/
├── utils/                 # 工具函数
└── uploads/               # 上传文件
```

## 核心组件

### 1. 主应用 (app.py)
- Flask应用初始化和路由管理
- 学科、知识点、试卷、考试等核心API
- 缓存管理和性能监控
- 错误处理和日志记录

### 2. AI服务 (ai_service.py)
- 统一AI模型接口
- 支持Ollama、阿里云、腾讯云等多种AI服务
- AI响应生成和错误处理

### 3. 配置管理 (config/settings_manager.py)
- 系统设置的加载、保存和验证
- 学科特定设置管理
- AI模型配置

### 4. 工具模块 (utils/)
- 试卷解析器
- 知识库生成器
- 反馈管理器

## 构建和运行

### 环境要求
- Python 3.7+
- Flask及相关依赖（见requirements.txt）
- AI服务（Ollama或云服务API）

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行应用
```bash
python app.py
```

默认在 http://localhost:5000 运行

### 配置AI服务
1. 在设置页面配置AI模型类型和参数
2. 对于Ollama，确保服务在 http://10.132.60.111:11434 运行
3. 对于云服务，需要配置API密钥

## 开发约定

### 代码风格
- 遵循Python PEP8编码规范
- 函数和变量使用下划线命名法
- 类名使用驼峰命名法
- 重要函数添加文档字符串

### API设计
- RESTful风格API设计
- JSON格式请求和响应
- 统一的错误处理和状态码

### 缓存策略
- 内存缓存用于频繁访问的小数据
- 文件缓存用于AI生成的内容
- 缓存失效机制确保数据更新

### 日志记录
- 使用Python标准logging模块
- 不同级别日志记录（INFO、WARNING、ERROR）
- 关键操作和错误详细记录

## 学科数据结构

### 知识库 (knowledgebase.json)
```json
{
  "科目": "学科名称",
  "章节": {
    "章节名": {
      "mainConcepts": ["概念1", "概念2"],
      "mainContents": ["内容1", "内容2"]
    }
  }
}
```

### 考试模板 (testmodel.json)
```json
{
  "考试信息": {
    "考试名称": "考试名称",
    "总时长": "120分钟",
    "题型列表": [
      {
        "题型名称": "单项选择题",
        "题量": 10,
        "总分": 20,
        "考查重点": "考查重点",
        "内容范围": "内容范围"
      }
    ]
  }
}
```

## 扩展性设计

1. **学科扩展**: 通过添加学科目录和配置文件即可扩展新学科
2. **AI模型扩展**: 通过修改AI服务类支持新的AI模型
3. **题型扩展**: 通过修改试卷生成和评分逻辑支持新题型
4. **存储扩展**: 可替换JSON文件存储为数据库存储

## 性能优化

1. **缓存机制**: 多层缓存减少重复计算和AI调用
2. **异步处理**: 使用线程池处理耗时任务
3. **性能监控**: 关键API添加性能监控装饰器
4. **资源压缩**: 静态资源压缩和合并

## 安全特性

1. **输入验证**: 所有用户输入进行验证和清理
2. **文件上传安全**: 严格的文件类型检查和路径验证
3. **XSS防护**: 使用bleach库清理HTML内容
4. **会话管理**: 考试会话的安全管理